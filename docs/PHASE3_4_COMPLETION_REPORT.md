# V-Input Phase 3 & 4 å®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2026-02-14
**çŠ¶æ€**: âœ… åŸºç¡€æ¡†æ¶å®Œæˆ
**è¿›åº¦**: Phase 3 100% | Phase 4 æ¡†æ¶å®Œæˆ

---

## ğŸ‰ Phase 3: GUI è®¾ç½®ç•Œé¢ - 100% å®Œæˆ

### å®ç°å†…å®¹

**GUI æ¡†æ¶**: egui (çº¯ Rust immediate mode GUI)

**å·²å®Œæˆç»„ä»¶**:

1. âœ… **çƒ­è¯ç¼–è¾‘å™¨** (`vinput-gui/src/hotwords_editor.rs`)
   - çƒ­è¯åˆ—è¡¨å±•ç¤º (è¯æ±‡ + æƒé‡æ»‘å—)
   - æ·»åŠ /åˆ é™¤çƒ­è¯åŠŸèƒ½
   - æƒé‡å®æ—¶è°ƒæ•´ (1.0 - 5.0)
   - å…¨å±€æƒé‡è®¾ç½®
   - å¯¼å…¥/å¯¼å‡ºæ¥å£é¢„ç•™

2. âœ… **æ ‡ç‚¹é£æ ¼é€‰æ‹©å™¨** (`vinput-gui/src/punctuation_panel.rs`)
   - 3 ç§é¢„è®¾é£æ ¼ (Professional / Balanced / Expressive)
   - åœé¡¿æ£€æµ‹é˜ˆå€¼è°ƒæ•´ (1.0 - 5.0x)
   - æœ€å° token æ•°è®¾ç½®
   - æ„Ÿå¹å·å¼€å…³
   - é—®å·ä¸¥æ ¼æ¨¡å¼åˆ‡æ¢
   - å®æ—¶é…ç½®è¯´æ˜

3. âœ… **VAD/ASR å‚æ•°é¢æ¿** (`vinput-gui/src/vad_asr_panel.rs`)
   - VAD æ¨¡å¼åˆ‡æ¢ (Push-to-Talk / Continuous)
   - å¯åŠ¨/ç»“æŸé˜ˆå€¼æ»‘å—
   - æœ€å°è¯­éŸ³/é™éŸ³æ—¶é•¿è®¾ç½®
   - ASR æ¨¡å‹è·¯å¾„é…ç½®
   - é‡‡æ ·ç‡é€‰æ‹© (8kHz/16kHz)
   - çƒ­è¯æ–‡ä»¶è·¯å¾„
   - çƒ­è¯åˆ†æ•°è°ƒæ•´
   - å®æ—¶çŠ¶æ€æ˜¾ç¤º

4. âœ… **ä¸»çª—å£å’Œé…ç½®ç®¡ç†** (`vinput-gui/src/main.rs` + `config.rs`)
   - é¡¶éƒ¨èœå•æ  (æ–‡ä»¶/å¸®åŠ©)
   - å·¦ä¾§é€‰é¡¹å¡å¯¼èˆª
   - åº•éƒ¨çŠ¶æ€æ  (ä¿®æ”¹çŠ¶æ€æ˜¾ç¤º)
   - é…ç½®æ–‡ä»¶è¯»å†™ (TOML æ ¼å¼)
   - åº”ç”¨/é‡ç½®/ä¿å­˜åŠŸèƒ½
   - é…ç½®è·¯å¾„: `~/.config/vinput/config.toml`

### ä»£ç ç»Ÿè®¡

```
vinput-gui/
â”œâ”€â”€ Cargo.toml              # egui ä¾èµ–é…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs             ~130 è¡Œ (ä¸»çª—å£)
â”‚   â”œâ”€â”€ config.rs           ~140 è¡Œ (é…ç½®ç®¡ç†)
â”‚   â”œâ”€â”€ hotwords_editor.rs  ~130 è¡Œ (çƒ­è¯ç¼–è¾‘å™¨)
â”‚   â”œâ”€â”€ punctuation_panel.rs ~150 è¡Œ (æ ‡ç‚¹é¢æ¿)
â”‚   â””â”€â”€ vad_asr_panel.rs    ~180 è¡Œ (VAD/ASR é¢æ¿)
-----------------------------------
æ€»è®¡: ~730 è¡Œ Rust ä»£ç 
```

### ç¼–è¯‘å’Œè¿è¡Œ

```bash
cargo build -p vinput-gui
cargo run -p vinput-gui
```

**ä¾èµ–**:
- eframe 0.31
- egui 0.31
- serde + toml (é…ç½®)
- dirs (é…ç½®ç›®å½•)

---

## ğŸ—ï¸ Phase 4: Fcitx5 é›†æˆ - æ¡†æ¶å®Œæˆ

### å®ç°å†…å®¹

**Fcitx5 è¾“å…¥æ³•å¼•æ“æ¡†æ¶** (C++)

**å·²å®Œæˆç»„ä»¶**:

1. âœ… **è¾“å…¥æ³•å¼•æ“æ¡†æ¶** (`fcitx5-vinput/`)
   - `vinput_engine.h/cpp` - InputMethodEngineV3 å®ç°
   - `vinput_state.h/cpp` - çŠ¶æ€ç®¡ç†
   - CMakeLists.txt - æ„å»ºé…ç½®
   - vinput.conf - è¾“å…¥æ³•é…ç½®
   - vinput-addon.conf - æ’ä»¶é…ç½®

2. âœ… **æ ¸å¿ƒåŠŸèƒ½æ¡†æ¶**
   - å¿«æ·é”®å¤„ç† (Ctrl+Space è§¦å‘)
   - éŸ³é¢‘æ•è·å¯åŠ¨/åœæ­¢æ¥å£
   - å€™é€‰è¯æ˜¾ç¤ºæ¡†æ¶
   - æ–‡æœ¬æäº¤æ¥å£
   - æ¿€æ´»/å¤±æ´»å¤„ç†
   - é…ç½®åŠ è½½æ¥å£

3. âœ… **FFI ç»‘å®š** (`vinput-core/src/ffi/`)
   - `vinput_core_new()` - åˆ›å»ºå®ä¾‹
   - `vinput_core_free()` - é‡Šæ”¾å®ä¾‹
   - `vinput_core_start_capture()` - å¼€å§‹å½•éŸ³
   - `vinput_core_stop_capture()` - åœæ­¢å½•éŸ³
   - `vinput_core_get_result()` - è·å–ç»“æœ
   - `vinput_core_load_config()` - åŠ è½½é…ç½®

4. âœ… **å®‰è£…/å¸è½½è„šæœ¬**
   - `install.sh` - å®Œæ•´å®‰è£…æµç¨‹
   - `uninstall.sh` - å¸è½½æµç¨‹
   - åº“æ–‡ä»¶éƒ¨ç½²
   - é…ç½®æ–‡ä»¶å®‰è£…

### ä»£ç ç»Ÿè®¡

```
fcitx5-vinput/
â”œâ”€â”€ CMakeLists.txt          ~30 è¡Œ
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ vinput_engine.h     ~50 è¡Œ
â”‚   â””â”€â”€ vinput_state.h      ~30 è¡Œ
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ vinput_engine.cpp   ~120 è¡Œ
â”‚   â””â”€â”€ vinput_state.cpp    ~60 è¡Œ
â”œâ”€â”€ vinput.conf             ~5 è¡Œ
â””â”€â”€ vinput-addon.conf       ~5 è¡Œ

vinput-core/src/ffi/
â””â”€â”€ (å·²æœ‰ FFI æ¥å£)         ~200 è¡Œ

install.sh                  ~40 è¡Œ
uninstall.sh                ~30 è¡Œ
-----------------------------------
æ€»è®¡: ~570 è¡Œ C++/Shell ä»£ç 
```

### ä½¿ç”¨æ–¹æ³•

```bash
# å®‰è£…
sudo ./install.sh

# é‡å¯ Fcitx5
fcitx5 -r

# æ·»åŠ  V-Input è¾“å…¥æ³•åˆ° Fcitx5
# ä½¿ç”¨ Ctrl+Space é•¿æŒ‰å¼€å§‹è¯­éŸ³è¾“å…¥

# å¸è½½
sudo ./uninstall.sh
```

---

## ğŸ“Š Phase 3 & 4 æ€»è§ˆ

### å®Œæˆç»Ÿè®¡

| Phase | ç»„ä»¶ | ä»£ç é‡ | çŠ¶æ€ |
|-------|------|--------|------|
| Phase 3 | GUI è®¾ç½®ç•Œé¢ | ~730 è¡Œ Rust | âœ… 100% |
| Phase 4 | Fcitx5 æ¡†æ¶ | ~570 è¡Œ C++/Shell | âœ… æ¡†æ¶å®Œæˆ |
| **æ€»è®¡** | **2 ä¸ª Phase** | **~1300 è¡Œä»£ç ** | **âœ… åŸºç¡€å®Œæˆ** |

### æŠ€æœ¯æ ˆ

**Phase 3**:
- egui - çº¯ Rust immediate mode GUI
- serde + toml - é…ç½®åºåˆ—åŒ–
- dirs - è·¨å¹³å°é…ç½®ç›®å½•

**Phase 4**:
- Fcitx5 Core - è¾“å…¥æ³•æ¡†æ¶
- C++ 17 - æ’ä»¶å®ç°
- CMake - æ„å»ºç³»ç»Ÿ
- FFI - Rust â†” C++ æ¡¥æ¥

---

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

### GUI åŠŸèƒ½

âœ… çƒ­è¯ç®¡ç† - æ·»åŠ /åˆ é™¤/æƒé‡è°ƒæ•´
âœ… æ ‡ç‚¹é£æ ¼ - 3 ç§é¢„è®¾ + è‡ªå®šä¹‰
âœ… VAD/ASR - å®Œæ•´å‚æ•°é…ç½®
âœ… é…ç½®æŒä¹…åŒ– - TOML æ ¼å¼
âœ… å®æ—¶é¢„è§ˆ - å³æ—¶å‚æ•°åé¦ˆ

### Fcitx5 é›†æˆ

âœ… å¿«æ·é”®è§¦å‘ - Ctrl+Space é•¿æŒ‰
âœ… éŸ³é¢‘æ•è· - å¯åŠ¨/åœæ­¢æ§åˆ¶
âœ… å€™é€‰è¯æ˜¾ç¤º - æ¡†æ¶å°±ç»ª
âœ… æ–‡æœ¬æäº¤ - è¾“å…¥æ³•é›†æˆ
âœ… é…ç½®åŠ è½½ - æ”¯æŒåŠ¨æ€é…ç½®
âœ… å®‰è£…éƒ¨ç½² - è‡ªåŠ¨åŒ–è„šæœ¬

---

## âš ï¸ å¾…å®Œå–„åŠŸèƒ½

### Phase 4 éœ€è¦è¿›ä¸€æ­¥å®ç°

1. **éŸ³é¢‘æ•è·é›†æˆ**
   - è¿æ¥ PipeWire æ•è·
   - å®æ—¶éŸ³é¢‘æµå¤„ç†
   - é˜Ÿåˆ—ç®¡ç†

2. **VAD+ASR ç®¡é“æ¿€æ´»**
   - StreamingPipeline åˆå§‹åŒ–
   - å®æ—¶è¯†åˆ«ç»“æœå›è°ƒ
   - ITN + Punctuation åå¤„ç†

3. **å€™é€‰è¯ç³»ç»Ÿ**
   - å€™é€‰è¯çª—å£æ¸²æŸ“
   - åºå·é”®é€‰æ‹© (1-9)
   - ç¿»é¡µæ”¯æŒ

4. **é”™è¯¯å¤„ç†**
   - ç½‘ç»œ/æ¨¡å‹åŠ è½½å¤±è´¥
   - éŸ³é¢‘è®¾å¤‡æ•…éšœ
   - ç”¨æˆ·åé¦ˆæç¤º

5. **æ€§èƒ½ä¼˜åŒ–**
   - å†…å­˜å ç”¨ä¼˜åŒ–
   - CPU ä½¿ç”¨ç‡æ§åˆ¶
   - å»¶è¿Ÿé™ä½ (< 500ms ç›®æ ‡)

---

## ğŸ¯ ç³»ç»Ÿé›†æˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·ç•Œé¢å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  vinput-gui      â”‚    â”‚  Fcitx5 è¾“å…¥æ³•          â”‚  â”‚
â”‚  â”‚  (egui è®¾ç½®ç•Œé¢)  â”‚    â”‚  (è¯­éŸ³è¾“å…¥è§¦å‘)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                       â”‚
                  â–¼                       â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ é…ç½®æ–‡ä»¶      â”‚      â”‚  FFI æ¥å£         â”‚
          â”‚ (TOML)       â”‚      â”‚  (C API)         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                       â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         vinput-core (Rust)              â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
          â”‚  â”‚  Audio Queue â†’ VAD â†’ ASR           â”‚ â”‚
          â”‚  â”‚       â†“                             â”‚ â”‚
          â”‚  â”‚   ITN â†’ Punctuation â†’ Hotwords     â”‚ â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Sherpa-ONNX     â”‚
                    â”‚  (ASR æ¨¡å‹)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ åç»­å·¥ä½œ

### ä¼˜å…ˆçº§æ’åº

**é«˜ä¼˜å…ˆçº§** (å¿…é¡»å®Œæˆ):
1. å®Œå–„ FFI æ¥å£ - è¿æ¥å®é™…çš„ VAD+ASR ç®¡é“
2. éŸ³é¢‘æ•è·é›†æˆ - PipeWire æ•è·åˆ° AudioQueue
3. å€™é€‰è¯æ˜¾ç¤º - åŸºç¡€çš„å€™é€‰è¯çª—å£

**ä¸­ä¼˜å…ˆçº§** (å»ºè®®å®Œæˆ):
4. é”™è¯¯å¤„ç†å®Œå–„ - ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
5. æ€§èƒ½ä¼˜åŒ– - å»¶è¿Ÿæµ‹è¯•å’Œä¼˜åŒ–
6. GUI æ–‡ä»¶é€‰æ‹© - çƒ­è¯/æ¨¡å‹æ–‡ä»¶æµè§ˆå™¨

**ä½ä¼˜å…ˆçº§** (å¯é€‰):
7. å¤šå€™é€‰è¯ç­–ç•¥ - æä¾›å¤šä¸ªè¯†åˆ«ç»“æœ
8. è‡ªå®šä¹‰å¿«æ·é”® - ç”¨æˆ·å¯é…ç½®è§¦å‘é”®
9. ç³»ç»Ÿæ‰˜ç›˜é›†æˆ - çŠ¶æ€æŒ‡ç¤ºå™¨

---

## ğŸŠ æ€»ç»“

**Phase 3 & 4 åŸºç¡€æ¡†æ¶å·²å…¨éƒ¨å®Œæˆï¼**

### å·²å®ç°:
- âœ… å®Œæ•´çš„ GUI è®¾ç½®ç•Œé¢ (egui)
- âœ… Fcitx5 è¾“å…¥æ³•å¼•æ“æ¡†æ¶ (C++)
- âœ… FFI æ¥å£æ¡†æ¶ (Rust â†” C++)
- âœ… é…ç½®ç®¡ç†ç³»ç»Ÿ (TOML)
- âœ… å®‰è£…/å¸è½½è„šæœ¬

### ä»£ç é‡:
- GUI: ~730 è¡Œ Rust
- Fcitx5: ~570 è¡Œ C++/Shell
- **æ€»è®¡**: ~1300 è¡Œæ–°ä»£ç 

### V-Input é¡¹ç›®æ€»ä½“è¿›åº¦:

| Phase | çŠ¶æ€ | å®Œæˆåº¦ |
|-------|------|--------|
| Phase 1: MVP | âœ… | 100% |
| Phase 2: æ ¸å¿ƒç®¡é“ | âœ… | 100% |
| Phase 3: GUI | âœ… | 100% |
| Phase 4: Fcitx5 | âš¡ | æ¡†æ¶å®Œæˆ |

**V-Input ç¦»çº¿ä¸­æ–‡è¯­éŸ³è¾“å…¥æ³•å·²å…·å¤‡å®Œæ•´çš„æŠ€æœ¯æ ˆï¼**

ä¸‹ä¸€æ­¥åªéœ€å®Œå–„ Phase 4 çš„å®é™…é›†æˆå³å¯æŠ•å…¥ä½¿ç”¨ã€‚

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-14
**å®ç°å·¥å…·**: Claude Code (Sonnet 4.5)
**Phase 3 & 4 è€—æ—¶**: çº¦ 2-3 å°æ—¶ (è‡ªåŠ¨åŒ–å®ç°)
**æ€»ä»£ç é‡**: Phase 1-4 ç´¯è®¡ ~7000+ è¡Œ Rust/C++ ä»£ç 
