# ITN "标点" 识别问题修复

## 问题描述

用户报告 "标点" 被错误识别为 "标0."

## 根本原因

在 `ChineseNumberConverter` 中，"点" 字符被无条件识别为小数点，导致：
- "标点" → "标0." （"标" 不是数字，"点" 被识别为小数点，后面没有数字所以是 0）
- "一点钟" → "1.钟" （"一点" 被识别为 1.0，"钟" 保留）

## 修复方案

在 `vinput-core/src/itn/chinese_number.rs` 中添加了更严格的小数点检查：

**修复前**:
```rust
// 只要找到 "点" 就作为小数点处理
if let Some(dot_pos) = text.find('点') {
    // 处理小数...
}
```

**修复后**:
```rust
// 只有当 "点" 前后都有数字字符时才作为小数点处理
if let Some(dot_pos) = text.find('点') {
    let has_digit_before = integer_part.chars().any(|c| matches!(c,
        '零' | '一' | '二' | '三' | '四' | '五' | '六' | '七' | '八' | '九' |
        '十' | '百' | '千' | '万' | '亿'
    ));

    let has_digit_after = !decimal_part.is_empty() &&
        decimal_part.chars().next().map_or(false, |c| matches!(c,
            '零' | '一' | '二' | '三' | '四' | '五' | '六' | '七' | '八' | '九'
        ));

    // 只有前后都有数字才作为小数点
    if has_digit_before && has_digit_after {
        // 处理小数...
    }
}
```

## 测试结果

| 输入 | 修复前 | 修复后 | 状态 |
|------|--------|--------|------|
| "标点" | "标0." | "标点" | ✅ 修复 |
| "标点符号" | "标0.符号" | "标点符号" | ✅ 修复 |
| "这是标点" | "这是标0." | "这是标点" | ✅ 修复 |
| "一点钟" | "1.钟" | "一点钟" | ✅ 修复 |
| "零点五" | "0.5" | "0.5" | ✅ 保持 |
| "三点一四" | "3.14" | "3.14" | ✅ 保持 |

## 单元测试

所有 139 个单元测试通过 ✅

## 影响范围

- 修复了 "标点" 等非数字词汇被错误转换的问题
- 保持了正常小数识别功能（如 "零点五" → "0.5"）
- 不影响其他 ITN 功能

## 部署说明

1. 重新编译核心库：
   ```bash
   cd vinput-core
   cargo build --release
   ```

2. 重新安装插件：
   ```bash
   sudo ./install-fcitx5-plugin.sh
   ```

3. 重启 Fcitx5：
   ```bash
   fcitx5 -r
   ```

## 验证方法

测试以下输入：
- 说 "标点" → 应该输出 "标点"
- 说 "标点符号" → 应该输出 "标点符号"
- 说 "零点五" → 应该输出 "0.5"

---

**修复时间**: 2026-02-16
**修复版本**: v0.1.1
**状态**: ✅ 已修复并测试通过
